// ==UserScript==
// @name         暗夜刀锋生成器
// @author       叁崎
// @version      1.0.0
// @description  根据核心书内容编写的npc、场景、刻痕生成器，使用.bitd查看指令帮助
// @homepageURL  https://sealdice.github.io/sealdice-manual-next/advanced/js_example.html
// @license      MIT
// ==/UserScript==


const SCENE_ST = {
    "氛围":["黑暗冷酷","鲜亮活泼","宁静优雅","破败废弃","拥挤嘈杂","舒适温暖"],
    "所见":["雨蒙城市，油浮水面","灯光闪烁，暗影飘忽","水汽，雾霭，霜冻","鬼影飘忽，幽灵领域中的回响","煤灰，铅云，尘垢","电能激荡，电线，机械装置"],
    "所听":["机械运作声和工人劳作声","大风呼啸，衣物猎猎","笑声，歌声，乐曲声","低语声，回声，奇异怪声","雷声滚滚，大雨瓢泼","铃铛声，钟鸣声，港口号角声"],
    "所嗅":["灶火味与熔炉气味","潮木头味、腐烂味、垃圾味","动物味，兽皮味，血液味","炼金物气味，馏出物气味，烟熏味","雨水味，海水味","臭氧气味，灵质放电气味"],
    "用途":["住宅","手工业","劳动","商铺","贸易","服务业","法律与行政","公共空间","能源","工业生产","运输","休闲","恶欲","娱乐","贮藏","耕种","学术","艺术"],
    "类型":["狭窄车道","窄巷","曲折街道","坑洼道路","桥梁","水道","封闭式街区","开放式广场","铺砖大道","地下通道","宽阔林荫道","环岛路口","高架","没入水中","悬吊","地下河","漂浮流动","私人，门禁"],
    "细节":["金属基座","铁铸大门和栅栏","暖炉烟囱","金属格栅、舱口、门扉","发条机械","绳索和电缆","楼梯、坡道、露台","木制脚手架","过街天桥","屋顶场所","轨道和火车车厢","隐藏通道","横幅与旗帜","节日装饰物","人群、游行、热闹","街头艺人","临时摊位、窝棚","纵横交错的道路","帮派标志","巡逻哨站","瞭望台","仓储和公众处刑地","街头哭喊、幻象","书报亭、公告栏","流浪动物","园艺绿化","污物泥泞","施工，拆迁","污水径流、雾霾、浓烟","孤儿、乞丐","古代废墟","怒目石像鬼","灵钟鸣动，灵魂监守","怪诞虚无","隔离，封锁","圣地祭品"],
    "事物":["网和绳索","板条箱和盒子","电缆和链条","排水管","水泵","油桶","砖摞","铁栏杆","木板","切割石块","成堆岩石","水泥桶","下水道格栅","腐烂废物","泥水坑","废旧物品","腐肉和群鸦","潮湿垃圾","四轮马车","手推车","停泊的船只","货运驳船","凤尾船","货运马车","吊机与滑轮","成捆货物","金属锭","工业锻造品","煤等燃料","垃圾桶","路灯","电线","配电箱","探照灯塔","钟楼","邮局","枯树","纪念碑","人造喷泉","苔藓满布的废墟","坍塌的建筑","摇摇欲坠的棚屋","路障","大门","检查站","碎石堆","运河船闸","闪电屏障"]
};

const SCENE_ID = {
    "外墙材料":["灰砖","石木混建","切割石块","木板","石膏板与木材","金属薄板"],
    "外墙细节":["砖艺装饰","铁艺装饰","玻璃装饰","石艺装饰","木艺装饰","园艺造景"],
    "用途普遍":["出租屋","旅馆","酒馆","赌场","毒窝","妓院","集市","工坊","面包店","屠宰场","锻造间","裁缝铺","工作室","山羊厩","啤酒厂","警察哨站","法庭、监狱","船坞","废墟","联排房屋","廉租公寓","公寓楼","小房子","澡堂","圣祠","纹身店","外科诊所","坑斗场","广场、喷泉","石窟","仓库","堆场","工厂","精炼厂","鳗鱼养殖场","蘑菇园"],
    "用途少见":["集市管理所","餐厅","酒吧、休息室","学院","沙龙","咖啡馆","花园","烟草店","书店","珠宝店","成衣店","展览馆","药房","马厩","酿酒厂","红酒铺","大师工艺室","船屋","剧场","歌剧院","公寓大楼","联排豪宅","庄园宅邸","度假别墅","专科诊所","神殿","水塔","警察哨塔","公园","纪念碑","档案馆","灵地","银行","炼金堂","发电厂","光辐花园"],
    "细节":["滴滴漏水","地板嘎吱","熊熊烈焰","熏黑油灯","嗡嗡电灯","发条嘀嗒","绿植、花卉","壁挂、艺术品","紧锁的窗户","厚重的窗帘和地毯","灰尘与碎屑","磨损与毁坏","破烂褴褛","实用陈设","优雅华丽","豪华奢靡","粗犷简朴","艰苦节俭","螺旋楼梯和直梯","密门","房沿猫道","天窗","阳台","地窖","寒冷漏风","粗犷寂静","舒适温暖","宏伟宽敞","低矮狭小","摇摇欲坠","怪异设备","怪诞物件","灵魂卫士、古老符文","堆积把玩奇物","古玩陈列","圣祠、祭坛"],
    "物品":["黑板","办公桌和文件","地图","图表和示意图","书籍","卷轴和书架","台灯","墨水瓶和写字台","时钟","柜子和搁板","桌子","椅子和笔记本"," 床铺","书桌和梳妆台","双层床","凳子和旅行箱","盆","水壶和镜子","沙发","长椅和音乐盒","躺椅","桌子和灯具"," 窗帘","抱枕和靠垫"," 柜台","水槽和橱柜","炉灶","壶","锅和餐盘","餐桌","椅子和餐具","棋盘","纸牌和骰子","食品库","调味料和肉钩","红酒","啤酒和威士忌"," 基座","雕像和绘画","鸟笼","羽毛笔和日记簿","铃铛","书本和蜡烛","壁炉","毯子和扶手椅","窗帘","花瓶和鲜花","乐器和乐谱"," 手术椅和医疗器具","燃烧嘴","药瓶和烧杯","工作台","工具和抹布","武器和弹药"]
};

const NPC = {
    "性别":["::2::男性","::2::女性","不明、隐秘"],
    "出身":["::6::阿克洛斯","::2::斯科夫兰","伊鲁维亚 ","匕首群岛 ","赛维洛斯 ","泰彻洛斯"],
    "外貌":["魁梧","可爱","饱经风霜","轮廓分明","英武健壮","苗条","忧郁","秀丽","粗壮","纤弱","伤疤","骨瘦如柴","疲惫","粗野","丰满","精瘦","俊秀","矮小","高挑","性感","狂野","优雅","佝偻","小巧","平平无奇","年迈","年轻","时髦","古怪","毁容、残废","戴一副眼镜或单片眼镜","假肢或跛足","长发","短发","纹身","光头","戴假发","蓄须","长发、蓄须"],
    "目标":["财富","力量","权威","声誉与名望","掌控","知识","闲适","复仇","自由","功绩","幸福","恐怖恶名","尊重","爱","改变","混乱与毁灭","正义","合作"],
    "首选手段":["暴力","威胁","谈判","研究","操纵","谋划","盗窃","神秘","商务","辛劳工作","法律与政治","破坏","诡计","炼金","敲诈勒索","团队合作","间谍行动","混乱无序"],
    "职业普遍":["面包师","理发师","铁匠","酿酒师","屠夫","木匠","造车匠","蜡烛商","店员","鞋匠","箍桶匠","农民","篷车夫","染布匠","刺绣工","鱼贩","凤尾船夫","守卫","皮革匠","石匠","外贸商","屋顶工","制绳匠","制毯匠","仆役","造船匠","罪犯","定衣裁缝","鞣革匠","修补匠","摊贩","纺织工","伐木工","牧羊人","邮递员","海员"],
    "职业少见":["辩护律师","建筑师","艺术家","作家","法警","养蜂人","银行家","赏金猎人","钟表匠","交际花","皮草商","吹玻璃匠","外交官","狱警","珠宝匠","毒蛭","锁匠","地方法官","音乐家","医师","管道工","印刷工","学者","书记员","火花发明家","税务员","财务员","低语","作曲家","管家","船长","灵魂监守","新闻记者","探险家","铁道护卫","军人","贵族"],
    "特征":["迷人","冷酷","骑士精神","傲慢","疑心重","强迫症","敏锐","沉默","喜怒无常","暴烈","疏忽大意","不露声色","无情","精于算计","桀骜不驯","仁慈","洞察敏锐","虚伪","耐心","恶毒","见多识广","偏执妄想","热忱","精英主义","野蛮","合作精神","高傲","自信","自视甚高","大胆","易怒","坦率","狡猾","忧郁","高深莫测","沉着"],
    "兴趣":["精致的威士忌、红酒、啤酒 ","精致的食物和餐厅","盛装、珠宝、皮草","精美的艺术品、歌剧、戏剧","油画，素描，雕塑","历史，传说","建筑，家具","诗歌，小说，写作","坑斗，决斗","被遗忘的众神","血肉之躯无我教会","回响道途","哭泣女士，慈善机构","古董、遗物、收藏品","马匹，骑乘","小发明，新科技","武器收藏家","音乐，乐器，舞蹈","狩猎，射击","烹饪，园艺","赌博，骰子，纸牌","自然哲学","毒品，精华，烟草","情人，浪漫，幽会","聚会，社交活动","探索，冒险","宠物（鸟，猫，狗）","手工艺（例如制革）","船只，划船","政治，新闻","神秘书籍，仪式","幽灵光谱学，电离灵质","炼金学，医学","精粹，炼金术","恶魔的故事和传说","大灾变前传说"],
    "特色":["迷信，坚信征兆和魔力数字","忠于家族","与权威门阀结姻","为维护己方地位而潜入其他派系","深居简出，总是通过信使与外界交流","欠银行/家族/罪犯的巨额债务","对朋友、盟友、家人等人的错误视而不见","曾成空壳，而后复原，不受灵魂侵扰","患有经常需要疗养的慢性病","秘密地（公开地？）被附身的灵魂控制","为一个恶魔的愿景所服务（知不知情都有可能）","以自己的出身、习俗和母语为傲","因自己的仪表、流言蜚语、及同辈表现而忧虑","瘾君子或酒鬼，常因其恶欲而吃亏","靠勒索来维持自己的地位","依赖会议做出裁决","在统一战争中犯下过罪孽","利用假身份过着双重生活","家族或组织的害群之马/被放弃者","入狱或被贵族软禁中","交游广泛，人脉遍布多斯科沃城外","革命，密谋反抗帝国","继承人，但可能配不上或是不想要那个位置","名流，因著作/歌曲/戏剧而出名","声名狼藉（罪有应得，或者并非）","身边充斥着阿谀奉承之人","无瑕美名，被高度重视","偏执敌视某个文化/信仰/社会阶级","高瞻远瞩，对未来的看法十分深刻","被幽灵或恶魔所诅咒、纠缠、侵扰","强烈且不正常的恐惧或厌恶","广泛接受了各个学术课题的培训教育","分类归纳那些日记、笔记、速记、账簿。","盲目地忠于理想、团体或传统","极为传统，反对新思想","一个骗子，捏造了一些重要事物"],
    "名字":["阿德瑞克","阿尔多","阿莫森","安德鲁","亚登","亚林","阿尔廓","阿沃斯","阿什林","布拉农","布瑞斯","布朗斯","布雷纳","布里克","坎德拉","卡里萨","卡罗","卡斯林","卡维尔","克莱夫","科瑞尔","克罗斯","克劳尔","赛瑞恩","达芬妮雅","达夫","伊德朗","埃米琳","格莱恩","海佑斯","黑克斯","霍尔茨","卡玫琳","克莱","寇博","克里斯托弗","路狄亚丝","洛瑞娅","琳涅娅","莱泽特","洛雷特","鲁斯拉","琳希亚","玛拉","米洛斯","莫兰","迈瑞","纳克斯","纳尼亚","诺戈斯","奥德芮妮","奥兰","费恩","珀罗尼亚","葵斯","雷米亚","锐英","罗埃斯","西斯瑞斯","西丝拉","斯堪洛恩","斯塔夫鲁","斯蒂夫","希拉","塔莉萨","泰斯林","塞纳","提莫斯","托克尔","乌娜","法夫林","维勒瑞斯","维瑞塔","维斯特涅","维依","瓦莱特","沃德","维沃尔","韦斯特","扎米拉"],
    "姓氏":["阿卡亚特","亚兰","阿萨诺克","巴斯兰","博登","布克尔","鲍尔曼","布里切农","布罗干","克里兰德","柯里尔蒙特","科尔布恩","康博尔","达瓦","戴莫","丹菲尔德","杜维尔","法罗斯","格瑞尼","海格","黑尔寇","海耶尔斯","伽安","杰杜因","卡德拉","卡尔斯塔斯","克奥","克撒尼","金克拉斯","洛蒙德","马洛顿","米彻特尔","莫里斯顿","潘德瑞恩","普理查德","洛万","西沃里","斯凯寇兰","斯寇拉","斯拉尼","斯特朗福德","斯特拉米尔","特兰普敦","泰康尼尔","沃尔","瓦伦德","威尔克"],
    "绰号":["铃声","白桦","红砖","飞虫","钟声","死亡缠绕","蟋蟀","十字架","乌鸦","回音","燧石","青蛙","霜冻","抓手","神枪手","锤手","钩子","废人","薄雾","月亮","钉子","针头","食人魔","水塘","叮当","红宝石","银币","油皮","歌者","骨刺","切断","蓟花","荆棘","滴答","十二","悍妇","长鞭","柳条人"]
};

const DEVIL = {
    "恶魔名字":["寇维斯","瑟维拉克西斯","亚盖兹","扎沃洛克罗斯","凯斯特拉","亚克维隆","伊克西斯","凯隆拉克斯","沃德兰奈","埃斯科塔","亚德兰纳克斯","凯拉斯特拉","奥尼克萨斯","阿含祖","泰拉克西斯","阿扎拉克斯","瓦斯卡拉"],
    "恶魔特征":["漆黑鲨鱼眼","鳞片（玛瑙、虹彩、水晶、金属等）","剃刀利爪","骨刺突出","多只眼睛","盘起的尾巴","革状翼","尾刺","滴淌脓水","发光的眼睛或胎记","头发或皮毛（如同在水中漂浮、燃烧着冷火等）","羽毛","多条手臂","触须","硬质甲壳","金属骨甲","灯光闪烁或是暗淡","植物枯萎或疯长","机械尖叫着停止运作","液体冻结","沸腾","变为血液或是灰烬"],
    "幽灵特征":["嫉妒","孤注一掷","暴力","歇斯底里","轻浮","转瞬即逝","好奇","欺诈","聪明","调研","知识渊博","迷人","预言","洞察","直率","启示","引路","指导","消极","戊边","强势","坚持","大胆","严苛愤怒","易怒","桀骜","野性","野蛮","睚眦必报发狂","混乱","古怪","毁灭","疯癫","卑鄙"],
    "幽灵引发效应":["阴冷寒霜","寒风","此地过去的模糊幻景","静电","诡异阴影","微弱回响","水汽薄雾","疾风","强烈的幻景回响","强磁性","恐怖阴影","雷鸣巨响","冻雾","暴风","漆黑一片","闪电","痛苦阴影","脑中声响"],
    "恶魔类型":["::3::人形，具有野兽或元素特征","动物","怪兽","无定形"],
    "亲和元素":["海洋，水","黑暗","大地，金属","火焰，烟雾","天空，星辰","风暴，气流"],
    "恶魔欲望":["残害","谋杀","正义","贪腐","力量","控制","知识","享乐","折磨","战争","复仇","混乱","自由","野蛮","操纵","骗局","恐惧","功业"],
    "被召唤的惊骇憎物":["沸腾焦油","扭曲集群","光辉生物","碎裂晶体","伏行草木","活体岩石","热烬云团","阴影生物","昆虫集群","剧毒云雾","炽热存在","液态生物","剥皮生物","破布傀儡","冰冷火焰","超越几何体","畸形怪物","闪光球体","扭曲机械","灵能迷雾","悸动内脏","金属生物","缠绕荆棘","催眠光芒","黏液蠕虫","震波能量","虬结铁钩","黑曜骷髅","流体水银","苦痛黑暗","漂浮章鱼","甜腻蒸汽","涡流粘液","蛇形生物","虫形生物","毁灭法球"]
};

const GOD = {
    "被遗忘的众神":["万物归一者","银焰","狂喜和弦","陨落之星","深潜领主","无声之歌","荆棘女士","我等血中荣光","至高牡羊","虚无容器","永闭之眼","哀痛之手","饥渴异物","千面","苦痛织网","黑夜支柱","焚毁之王","深渊父亲","遗弃军团","不灭骄阳","启示录","光辉圣言","遮蔽女王","调和恩典","哀愁阴云","破碎圆环","征服者","残戮于黑暗中的她","超越死亡之梦","鲜血暗潮","门之守卫","虚空巨口","护火者","审判王座","失落冠冕","黄金雄鹿"],
    "邪教活动":["献祭：被喂给极为神圣的野兽/被狂热的邪教暴徒残害（吃掉？）。","献祭：在死亡竞技场中对抗一位受膏冠军。","献祭：仪式性地在圣坛上放血。","献祭：逐步过量地服用拓展思维的毒品。","献祭：仪式性地杀害宣称自己受膏的灵魂冠军。","献祭：通过神秘手段（电刑、灵魂毁灭、死亡诅咒）杀害。","集会：一场享乐（性交、食物、舞蹈、音乐）且痛苦的纵欲。","集会：持续数天的圣歌或祷告。","集会：在星历合流期占据神圣纽带点位。","集会：前往圣地、死域、或海上朝圣。","集会：集体通过精华、毒品或冥想来探索幻象或是梦境。","集会：神圣事件的重现或哑剧表演。","获取：神秘学者或恶魔的眼睛/心脏/血液制物。","获取：破碎圣物的碎片（宝石、剑、头骨、石头等）。","获取：先知/大师/圣人的原始神圣手稿。","获取：异教徒或叛教者被切下的肢体（头、手、舌）。","获取：与神圣几何相吻合或与神秘事件同调的物品。","获取：先知/神秘学者/创始人/教团敌人的幽灵。","毁灭：焚烧圣物（符文页、圣像、血肉、毛发）的仪式。","毁灭：根除灵魂或恶魔的仪式。","毁灭：打破将神明阻挡在世界之外的封印。","毁灭：破坏敌对教团的仪式用品/圣坛/神殿。","毁灭：铲除可能伤害到神明的武器/物品/场所/仪式。","毁灭：铲除威胁到教团的社会/法律/文化方面事物。","祝圣：沐浴在神圣液体（血液、红酒、牛奶、油等）中得到净化。","祝圣：净化门，使上帝得以踏入这个世界。","祝圣：将信徒或物品浸入灵井来进行洗礼/祝福。","祝圣：用纹身/划痕/切断肢体来净化/祝福信徒。","祝圣：创作受祝的偶像/艺术品/仪式场所/手工制物。","祝圣：装置/符文/受缚灵魂用以卫敌。","亵渎：诋毁或玷污那些敌对教团的宣誓者。","亵渎：腐化场所/物品/仪式/传统，来盗取其力量。","亵渎：玷污场所/物品/仪式，来羞辱其他教团。","亵渎：操纵当权者/机构，来盗取其权力。","亵渎：腐化追随者，为他们的转化做好准备。","亵渎：无心智、无意义的混乱；埋下动荡的种子。"]
};

const SCORE = {
    "客户/目标":["平民-科研人员或学者","平民-劳工或技工","平民-密送人或海员","平民-外贸商或店主","平民-艺术家或作家","平民-医生或炼金师","罪犯-毒贩或制毒商","罪犯-雇佣兵或暴徒","罪犯-销赃犯或赌徒","罪犯-间谍或线人","罪犯-走私犯或窃贼","罪犯-犯罪首脑","政治-贵族或官僚","政治-银行家或船长","政治-革命者或难民","政治-神职人员或邪教徒","政治-蓝衫军或督察官","政治-治安法官或政客","奇异-幽灵","奇异-玄奥事物收藏家","奇异-吸血鬼或其他不死生物","奇异-乔装的恶魔","奇异-附身或空壳","奇异-低语或邪教徒"],
    "工作":["诡诈-跟踪或监视","诡诈-破坏或纵火","诡诈-剽窃或栽赃","诡诈-投毒或制造事故","诡诈-盗窃或入室洗劫","诡诈-冒充或误导","暴力-暗杀","暴力-抹除或绑架","暴力-恐吓或敲诈","暴力-破坏或损毁","暴力-突袭或保卫","暴力-抢劫或武力强迫","黑道-护送或安保","黑道-走私或运送","黑道-敲诈或抹黑","黑道-欺诈或谍报","黑道-定位或隐匿","黑道-谈判或威胁","超凡：诅咒或祝圣","超凡-放逐或召唤","超凡-萃取精粹","超凡-安置或移除符文","超凡-执行或停止仪式","超凡-空壳化或复活"],
    "扭曲或复杂化":["一个要素实际上是邪教活动的掩护","一位神秘学者预知到了这次活儿，并且警告了有关各方","躁动灵魂附身了一部分/大部分/所有的相关人员","躁动灵魂出没于这一地点","这份工作推动了一个恶魔的秘密愿景","这份工作推动了一个吸血鬼的秘密愿景","一个要素实际上是犯罪业务的幌子","一个危险帮派在利用此地点","这份工作是敌人设下的陷阱","这份工作是为了另一份工作而设下的考验","这份工作推动了一个贸易勋爵的秘密愿景","这份工作推动了一个犯罪首脑的秘密愿景","这份工作必须乘电气铁路出行","这份工作必须前往死域完成","这份工作必须海航","这个地点是变动的（位置更改，在一辆车上，等）","这份工作推动了一个革命者的秘密愿景","这份工作推动了一个城市官僚的秘密愿景"],
    "相关人士":["玩家角色的朋友","玩家角色的竞争对手","玩家角色的恶欲满足者","集团的熟识","多斯科沃城中名流","怪诞幽灵，恶魔，神明"],
    "相关派系":["无形会","银钉队","司库洛克勋爵","蜂巢会","红焰环社","群鸦队","黑灯党","红绸党","昏光修女会","粉碎党","钩镰帮","游魂党","灰袍军","乌尔夫·铁裔","雾中猎犬","迷途众","市议会或基建基金会","铁钩监狱","灵魂监守","蓝衫军或督察官","帝国军","劳工或仆人","火花发明家","密送人或墨耙众","某个领事馆","运维部","利维坦猎人","海员或码头工人","凤尾船夫会或篷车夫帮","铁道护卫或掠火旅","血肉之躯无我教会","哭泣女士教会","被遗忘的众神","回响道途或调和灵集会","斯科夫兰难民","死域拾荒者"]
};

//=====function=====

function parseWeightedItem(item) {
    const match = item.match(/^::(\d+)::(.+)$/);
    if (match) {
        return {
            weight: parseInt(match[1], 10),
            value: match[2]
        };
    }
    return {
        weight: 1,
        value: item
    };
}

function weightedRandomFromArray(arr) {
    if (!arr || arr.length === 0) return "";

    let pool = [];
    for (let item of arr) {
        const parsed = parseWeightedItem(item);
        for (let i = 0; i < parsed.weight; i++) {
            pool.push(parsed.value);
        }
    }

    const idx = Math.floor(Math.random() * pool.length);
    return pool[idx];
}

function randFromTable(table, key) {
    if (!table[key]) return `（无${key}）`;
    return weightedRandomFromArray(table[key]);
}

function parseCount(cmdArgs) {
    const raw = cmdArgs.getArgN(2);
    let n = parseInt(raw, 10);
    if (isNaN(n) || n <= 0) n = 1;
    if (n > 5) n = 5;
    return n;
}

function randAllFromTable(table) {
    let result = [];
    for (let key in table) {
        result.push(`【${key}】${randFromTable(table,key)}`);
    }
    return result.join("\n");
}

//=====main=====

let ext = seal.ext.find('Bitd-Generator');
if (!ext) {
    ext = seal.ext.new('Bitd-Generator', '叁崎', '1.0.0');
    seal.ext.register(ext);
}

const cmdBitd = seal.ext.newCmdItemInfo();
cmdBitd.name = "bitd";
cmdBitd.help = `暗夜刀锋生成器 (v1.0)
根据核心书城市指南部分编写。
=========
指令格式: .bitd <类型> <数量>，一次最多生成5个。

可用指令：
.bitd 街头 / street: 生成多斯科沃街头场景
.bitd 室内 / indoor: 生成多斯科沃室内场景
.bitd 人民 / npc: 生成NPC/人物
.bitd 魔鬼 / devil: 生成魔鬼/幽灵
.bitd 众神 / god: 生成被遗忘的众神
.bitd 刻痕 / score: 生成刻痕
.bitd help / h: 显示此帮助
=========`;


cmdBitd.solve = function (ctx, msg, cmdArgs) {
    const arg = cmdArgs.getArgN(1);
    const count = parseCount(cmdArgs);
    const split = `=========\n`;

    switch (arg){
        case "h":
        case "help":{
            const ret = seal.ext.newCmdExecuteResult(true);
            ret.showHelp = true;
            return ret;
        }
        default:{
            if (arg == "街头" || arg == "street"){
                let text = `=== 街头场景 ===\n`;

                for (let i = 1; i <= count; i++){
                    text += `【用途】${randFromTable(SCENE_ST, "用途")}\n`;
                    text += `【类型】${randFromTable(SCENE_ST, "类型")}\n`;
                    text += `【氛围】${randFromTable(SCENE_ST, "氛围")}\n`;
                    text += `【所见】${randFromTable(SCENE_ST, "所见")}\n`;
                    text += `【所听】${randFromTable(SCENE_ST, "所听")}\n`;
                    text += `【所嗅】${randFromTable(SCENE_ST, "所嗅")}\n`;
                    text += `【细节】${randFromTable(SCENE_ST, "细节")}\n`;
                    text += `【事物】`;
                    for (let j = 1; j <= 5; j++){
                        text += `${randFromTable(SCENE_ST, "事物")}、`;
                    }
                    text += `${randFromTable(SCENE_ST, "事物")}\n`;
                    text += split;
                }
                seal.replyToSender(ctx, msg, text);
                return seal.ext.newCmdExecuteResult(true);

            }else if (arg == "室内" || arg == "indoor"){
                let text = `=== 室内场景 ===\n`;
                
                for (let i = 1; i <= count; i++){
                    text += (Math.random() < 0.7)?`【用途】${randFromTable(SCENE_ID, "用途普遍")}\n`:`【用途】${randFromTable(SCENE_ID, "用途少见")}`;
                    text += `【外墙材料】${randFromTable(SCENE_ID, "外墙材料")}\n`;
                    text += `【外墙细节】${randFromTable(SCENE_ID, "外墙细节")}\n`;
                    text += `【细节】${randFromTable(SCENE_ID, "细节")}\n`;
                    text += `【物品】`;
                    for (let j = 1; j <= 5; j++){
                        text += `${randFromTable(SCENE_ID, "物品")}、`;
                    }
                    text += `${randFromTable(SCENE_ID, "物品")}\n`;
                    text += split;
                }
                seal.replyToSender(ctx, msg, text);
                return seal.ext.newCmdExecuteResult(true);

            }else if (arg == "人民" || arg == "npc"){
                let text = `=== NPC 生成 ===\n`;

                for (let i = 1; i <= count; i++) {
                    text += `【姓名】${randFromTable(NPC, "名字")}·${randFromTable(NPC, "姓氏")}\n`;
                    text += `【绰号】${randFromTable(NPC, "绰号")}\n`;
                    text += `【性别】${randFromTable(NPC, "性别")}\n`;
                    text += `【出身】${randFromTable(NPC, "出身")}\n`;
                    text += (Math.random() < 0.7)?`【职业】${randFromTable(NPC, "职业普遍")}\n`:`【职业】${randFromTable(NPC, "职业少见")}\n`;
                    text += `【外貌】${randFromTable(NPC, "外貌")}\n`;
                    text += `【特征】${randFromTable(NPC, "特征")}\n`;
                    text += `【兴趣】${randFromTable(NPC, "兴趣")}\n`;
                    text += `【特色】${randFromTable(NPC, "特色")}\n`;
                    text += `【目标】${randFromTable(NPC, "目标")}\n`;
                    text += `【手段】${randFromTable(NPC, "首选手段")}\n`;
                    text += split;
                }

                seal.replyToSender(ctx, msg, text);
                return seal.ext.newCmdExecuteResult(true);

            }else if (arg == "魔鬼" || arg == "devil"){
                let text = `=== 恶魔 ===\n`;
            
                for (let i = 1; i <= count; i++) {
                    text += `【恶魔名字】${randFromTable(DEVIL, "恶魔名字")}\n`;
                    text += `【恶魔类型】${randFromTable(DEVIL, "恶魔类型")}\n`;
                    text += `【恶魔欲望】${randFromTable(DEVIL, "恶魔欲望")}\n`;
                    text += `【亲和元素】${randFromTable(DEVIL, "亲和元素")}\n`;
                    text += `【恶魔特征】${randFromTable(DEVIL, "恶魔特征")}\n`;
                    text += `【幽灵特征】${randFromTable(DEVIL, "幽灵特征")}\n`;
                    text += `【幽灵引发效应】${randFromTable(DEVIL, "幽灵引发效应")}\n`;
                    text += `【被召唤的惊骇憎物】${randFromTable(DEVIL, "被召唤的惊骇憎物")}\n`;
                    text += split;
                }

                seal.replyToSender(ctx, msg, text);
                return seal.ext.newCmdExecuteResult(true);

            }else if (arg == "众神" || arg == "god"){
                let text = `=== 众神 ===\n`;

                for (let i = 1; i <= count; i++) {
                    text += randAllFromTable(GOD);
                    text += "\n";
                    text += split;
                }

                seal.replyToSender(ctx, msg, text);
                return seal.ext.newCmdExecuteResult(true);

            }else if (arg == "刻痕" || arg == "score"){
                let text = `=== 刻痕 ===\n`;

                for (let i = 1; i <= count; i++) {
                    text += randAllFromTable(SCORE);
                    text += "\n";
                    text += split;
                }

                seal.replyToSender(ctx, msg, text);
                return seal.ext.newCmdExecuteResult(true);

            }else {
                const ret = seal.ext.newCmdExecuteResult(true);
                ret.showHelp = true;
                return ret;
            }
        }
    }
}

// 注册指令
ext.cmdMap['bitd'] = cmdBitd;

